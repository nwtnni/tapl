\documentclass{article}
\title{Chapter 03}
\author{Newton Ni}

\usepackage{bussproofs}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}

% Set cardinality: |#1|
\newcommand{\cardinality}[1]{\lvert#1\rvert}

% Set: { #1 }
\newcommand{\set}[1]{\{\ #1\ \}}

% Set comprehension: { #1 | #2 }
\newcommand{\comp}[2]{\set{#1\ \mid\ #2}}

% t₁, t₂, t₃, ...
\newcommand{\term}[1]{\texttt{t\textsubscript{#1}}}

% Monospace
\newcommand{\ms}[1]{\texttt{#1}}

\newcommand{\LabelR}[1]{\RightLabel{\textsc{#1}}}

\theoremstyle{remark}
\newtheorem*{case}{Case}

\begin{document}
\maketitle

\section{3.2.4}

    \textit{How many elements does $S_3$ have?}

    \begin{align*}
        \cardinality{S_0} &= 0 \\
        \cardinality{S_1} &= 3 \\
        \cardinality{S_2} &= 3^3 + 3 \cdot 3 + 3 = 39 \\
        \cardinality{S_3} &= 39^3 + 39 \cdot 3 + 3 = 59439
    \end{align*}

\section{3.2.5}

    \textit{Show that the sets $S_i$ are }cumulative\textit{---that is,}
    \textit{for each i we have $S_i \subseteq S_{i + 1}$.}

    \begin{proof}
        By induction on $i$. Our inductive hypothesis is:
        \begin{align*}
            H(i): S_i \subseteq S_{i + 1}
        \end{align*}

        \begin{case}[$i = 0$]
            By definition, $S_0 = \emptyset$, which is a subset of any set.
        \end{case}

        \begin{case}[$i > 0$]
            We want to show:
            \begin{align*}
                \forall t.\ t \in S_i \implies t \in S_{i + 1}
            \end{align*}

            By definition of $S_i$, $t$ must belong to one of three sets:

            \begin{itemize}
                \item{\set{\ms{true},\ \ms{false},\ \ms{zero}}}

                These are in $S_{i + 1}$ by definition.

                \item{\comp{\ms{succ \term{1}},\ \ms{pred \term{1}},\ \ms{iszero \term{1}}}{\term{1}\ $\in S_{i - 1}$}}

                By the inductive hypothesis, we know that $\term{1} \in S_i$.\\
                Then $\ms{succ \term{1}}, \ms{pred \term{1}}, \ms{iszero \term{1}} \in S_{i + 1}$, by construction.

                \item{\comp{\ms{if \term{1} then \term{2} else \term{3}}}{\term{1},\ \term{2},\ \term{3}\ $\in S_{i - 1}$}}

                Similarly, by the inductive hypothesis, $\term{1}, \term{2}, \term{3} \in S_i$,\\
                and $\ms{if \term{1} then \term{2} else \term{3}} \in S_{i + 1}$ by construction.
            \end{itemize}
        \end{case}
    \end{proof}

\section{3.5.5}

    \textit{Spell out the induction principle used in the preceding proof,}
    \textit{in the style of Theorem 3.3.4.}

    If, for each derivation $d$, given $P(d)$ for all immediate subderivations
    $c$ of $d$, we can show $P(d)$, then $P(d)$ holds for all $d$.

\section{3.5.10}

    \textit{Rephrase Definition 3.5.9 as a set of inference rules.}

    \begin{prooftree}
        \LabelR{B-Zero}
        \AxiomC{}
        \UnaryInfC{$t \longrightarrow^* t$}
    \end{prooftree}

    \begin{prooftree}
        \LabelR{B-One}
        \AxiomC{$t \longrightarrow t'$}
        \UnaryInfC{$t \longrightarrow^* t'$}
    \end{prooftree}

    \begin{prooftree}
        \LabelR{B-Trans}
        \AxiomC{$t \longrightarrow^* t'$}
        \AxiomC{$t' \longrightarrow^* t''$}
        \BinaryInfC{$t \longrightarrow^* t''$}
    \end{prooftree}

\section{3.5.13}

    \textit{Suppose we add a new rule:}
    \begin{prooftree}
        \LabelR{E-Funny1}
        \AxiomC{}
        \UnaryInfC{\ms{if true then \term{2} else \term{3} $\longrightarrow$ \term{3}}}
    \end{prooftree}
    \textit{to the ones in figure 3--1. Which of the above theorems}
    \textit{(3.5.4, 3.5.7, 3.5.8, 3.5.11, 3.5.12) remain valid?}

    \begin{itemize}
        \item 3.5.4 (\textsc{Determinancy of One-Step Evaluation}) no longer holds. As a counterexample:
            \begin{itemize}
                \item $\ms{if true then true else false} \longrightarrow \ms{true}$ by (\textsc{E-IfTrue})
                \item $\ms{if true then true else false} \longrightarrow \ms{false}$ by (\textsc{E-Funny1})
            \end{itemize}

        \item 3.5.7 (Every value is in normal form.) still holds.

        \item 3.5.8 (If \term{} is in normal form, then \term{} is a value.) still holds.

        \item 3.5.11 (\textsc{Uniqueness of Normal Forms}) no longer holds. The same
            counterexample as 3.5.4 can be used.

        \item 3.5.12 (\textsc{Termination of Evaluation}) still holds.
    \end{itemize}

    \pagebreak{}

    \textit{Suppose instead that we add this rule:}
    \begin{prooftree}
        \LabelR{E-Funny2}
        \AxiomC{\term{2} $\longrightarrow$ $\term{2}'$}
        \UnaryInfC{\
            \ms{if \term{1} then \term{2} else \term{3}}
            $\longrightarrow$
            \ms{if \term{1} then $\term{2}'$ else \term{3}}
        }
    \end{prooftree}
    \textit{Now which of the above theorems remain valid?}
    \textit{Do any of the proofs need to change?}

    \begin{itemize}
        \item 3.5.4 still holds, but its proof needs to be extended with another
            case for \textsc{E-Funny2}, which will be almost identical to \textsc{E-If}.

        \item 3.5.7 still holds.

        \item 3.5.8 still holds.

        \item 3.5.11 still holds.

        \item 3.5.12 still holds.
    \end{itemize}

\section{3.5.14}

    \textit{Show that Theorem 3.5.4 is also valid for the evaluation relation}
    \textit{on arithmetic expressions: if} $\term{} \longrightarrow \term{}'$ \textit{and}
    $\term{} \longrightarrow \term{}''$, \textit{then} $\term{}' = \term{}''$.

    \begin{proof}
        By structural induction on $\term{} \longrightarrow \term{}'$. Our inductive hypothesis is:
        \begin{align*}
            H(\term{} \longrightarrow \term{}'): \term{} \longrightarrow \term{}'' \implies \term{}' = \term{}''
        \end{align*}

        \begin{case}[\textsc{E-Succ}]
            Here \term{} is in the form $\ms{succ \term{1}}$. No other evaluation rules apply.
            Suppose $\ms{succ \term{1}} \longrightarrow t''= \ms{succ \term{1}$''$}$.
            By the inductive hypothesis, if $\term{1} \longrightarrow \term{1}''$,
            then $\term{1}' = \term{1}''$, and therefore $t' = t''$.
        \end{case}

        \begin{case}[\textsc{E-PredZero}]
            Here \term{} is in the form $\ms{pred}\ 0$. No other evaluation rules apply,
            so $\term{}'$ and $\term{}''$ can only be $0$.
        \end{case}

        \begin{case}[\textsc{E-PredSucc}]
            This case is analogous to \textsc{E-PredZero}.
        \end{case}

        \begin{case}[\textsc{E-Pred}]
            This case is analogous to \textsc{E-Succ}.
        \end{case}

        \begin{case}[\textsc{E-IsZeroZero}]
            This case is analogous to \textsc{E-PredZero}.
        \end{case}

        \begin{case}[\textsc{E-IsZeroSucc}]
            This case is analogous to \textsc{E-PredZero}.
        \end{case}

        \begin{case}[\textsc{E-IsZero}]
            This case is analogous to \textsc{E-Succ}.
        \end{case}

        \begin{case}[Other]
            The proof of all previous Boolean cases remains the same.
        \end{case}
    \end{proof}

\end{document}
